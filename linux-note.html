<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-05-11 四 20:30 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>linux命令杂记</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="org-html-themes/src/bigblow_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="org-html-themes/src/bigblow_theme/css/bigblow.css"/>
<link rel="stylesheet" type="text/css" href="org-html-themes/src/bigblow_theme/css/hideshow.css"/>
<script type="text/javascript" src="org-html-themes/src/bigblow_theme/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="org-html-themes/src/bigblow_theme/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="org-html-themes/src/bigblow_theme/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="org-html-themes/src/bigblow_theme/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="org-html-themes/src/bigblow_theme/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="org-html-themes/src/bigblow_theme/js/bigblow.js"></script>
<script type="text/javascript" src="org-html-themes/src/bigblow_theme/js/hideshow.js"></script>
<script type="text/javascript" src="org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">linux命令杂记</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org3766660">1. fd (find)</a></li>
<li><a href="#orgb4bf943">2. shell</a>
<ul>
<li><a href="#org9a43d6b">2.1. 忽略错误继续执行</a></li>
<li><a href="#org2a0730a">2.2. 退出 exit n</a></li>
<li><a href="#org5ce42c2">2.3. 判断文件是否存在</a></li>
</ul>
</li>
<li><a href="#org6e72e86">3. git</a>
<ul>
<li><a href="#org06b67fa">3.1. 设置/取消代理</a></li>
<li><a href="#org0882232">3.2. clone 子模块</a></li>
<li><a href="#org71dae92">3.3. 指定需要克隆的branch</a></li>
</ul>
</li>
<li><a href="#org0d47efc">4. grep -i 忽略大小写</a></li>
<li><a href="#orgb6f1276">5. fc-list 显示已安装字体</a></li>
<li><a href="#org41720d1">6. docker</a></li>
<li><a href="#orga5047f5">7. tar fvx XXX</a></li>
<li><a href="#orgfede6a4">8. du -h 以可读形式显示文件大小</a>
<ul>
<li><a href="#orgd6203f7">8.1. 查看目录下的大文件</a></li>
</ul>
</li>
<li><a href="#org0cc1a86">9. test命令</a></li>
<li><a href="#org836492d">10. bash脚本的编写</a>
<ul>
<li><a href="#org976a87f">10.1. <code>set -e</code> 遇到错误就停止</a></li>
</ul>
</li>
<li><a href="#org774f89f">11. pstree 查看进程树</a></li>
<li><a href="#org562155e">12. strace 追踪程序的系统调用</a></li>
<li><a href="#orgcd31302">13. objdump -D 显示可执行文件/库文件的反汇编</a></li>
<li><a href="#orgab42851">14. ldd 显示链接信息</a></li>
<li><a href="#org5dec9e4">15. code2html 的使用</a></li>
<li><a href="#org5feaf7b">16. wget 保存整个网站</a></li>
<li><a href="#org1ed9d66">17. 配置apt软件源</a></li>
<li><a href="#org26c06e7">18. 在ArchLinux中安装deb</a>
<ul>
<li><a href="#org5f89a47">18.1. debtap</a></li>
<li><a href="#org6d3030d">18.2. dpkg</a></li>
</ul>
</li>
<li><a href="#orgb00c1f6">19. <code>Xterm</code> 配置文件</a></li>
<li><a href="#org10cf1d4">20. ssh</a>
<ul>
<li><a href="#org250ee66">20.1. 重启ssh服务</a></li>
<li><a href="#org448d5de">20.2. 查看ssh服务是否启动</a></li>
</ul>
</li>
<li><a href="#orgde6aa5a">21. 递归改变文件owner</a></li>
<li><a href="#org6874d1e">22. 汇编文件(.s)的结构</a></li>
<li><a href="#orgbac7cc4">23. makefile</a>
<ul>
<li><a href="#org135ccae">23.1. 定义变量</a></li>
<li><a href="#orga60ea87">23.2. 伪目标 .PHONY</a></li>
<li><a href="#org92d112d">23.3. 为整个项目添加宏定义</a></li>
<li><a href="#orgabd670f">23.4. 为目标链接上库</a></li>
<li><a href="#org641d9ca">23.5. 通配符</a></li>
<li><a href="#org564dca4">23.6. 函数调用</a>
<ul>
<li><a href="#orgd48dc2c">23.6.1. 当前目录下某一类型的所有文件形成的列表</a></li>
<li><a href="#orgd539509">23.6.2. 将列表中的所有匹配项替换为指定形式</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org73834d2">24. GDB</a>
<ul>
<li><a href="#org75a7a21">24.1. 为可执行文件设置环境变量</a></li>
<li><a href="#org3ca96c9">24.2. 为可执行程序传参</a></li>
<li><a href="#orgab5d8cb">24.3. 显示某文件源代码</a></li>
<li><a href="#org01cc234">24.4. 添加断点</a></li>
<li><a href="#org1f5b8a2">24.5. 查看断点</a></li>
<li><a href="#org43a5966">24.6. 禁用断点</a></li>
<li><a href="#orgda59d2e">24.7. 重新启用断点</a></li>
<li><a href="#orga2c7a8d">24.8. 删除断点</a></li>
<li><a href="#org3c7a344">24.9. 保存断点到文件</a></li>
<li><a href="#org6a09d2a">24.10. 单步跳过 next</a></li>
<li><a href="#orgebfa63a">24.11. 继续执行, 直至遇到断点</a></li>
<li><a href="#orgfa7780c">24.12. 运行到某处,忽略期间的断点</a></li>
<li><a href="#orgab7ec9c">24.13. 进入到函数内部</a></li>
<li><a href="#org386d8b5">24.14. 从函数中跳出并暂停</a></li>
<li><a href="#orgde7f3c0">24.15. 强制从函数中返回特定值</a></li>
<li><a href="#org992d939">24.16. 跳转到指定位置继续执行</a></li>
<li><a href="#orgdc966cc">24.17. 显示当前所有的局部变量</a></li>
<li><a href="#org2bf9a09">24.18. 变量/表达式相关</a>
<ul>
<li><a href="#orgaac24c6">24.18.1. 打印变量/表达式</a></li>
<li><a href="#orgca13cf7">24.18.2. 自动显示变量值</a></li>
<li><a href="#org9206474">24.18.3. 取消对变量的自动显示</a></li>
<li><a href="#org5fd3c66">24.18.4. 显示变量/表达式类型</a></li>
<li><a href="#org124b2c1">24.18.5. 修改变量的值</a></li>
<li><a href="#orgdbe4131">24.18.6. 监视某变量的值</a></li>
</ul>
</li>
<li><a href="#org2a4793c">24.19. 栈相关</a>
<ul>
<li><a href="#org9668619">24.19.1. 显示堆栈信息: bt</a></li>
<li><a href="#org28f9c96">24.19.2. 切换栈帧</a></li>
</ul>
</li>
<li><a href="#org1692ab0">24.20. 调试已经运行的程序</a></li>
<li><a href="#org412df64">24.21. 检查点</a>
<ul>
<li><a href="#orge503029">24.21.1. 在当前位置添加checkpoint</a></li>
<li><a href="#org34e985e">24.21.2. 查看所有checkpoints</a></li>
<li><a href="#orge0c02b0">24.21.3. 删除指定checkpoint</a></li>
</ul>
</li>
<li><a href="#org1565b8c">24.22. 线程</a>
<ul>
<li><a href="#orgc2bbfbb">24.22.1. 显示所有线程</a></li>
<li><a href="#org63623b1">24.22.2. 切换到指定线程</a></li>
</ul>
</li>
<li><a href="#orgd887d01">24.23. 以指定格式显示某地址处的内容</a></li>
<li><a href="#org40faf3e">24.24. 反向运行</a></li>
</ul>
</li>
<li><a href="#org0e48f95">25. valgrind</a>
<ul>
<li><a href="#org0f47e0e">25.1. 无法使用, 报错</a></li>
</ul>
</li>
<li><a href="#org441336a">26. CMake</a></li>
<li><a href="#orgef9a14f">27. clangd 配置</a>
<ul>
<li><a href="#orgc9e1410">27.1. 配置纯C项目</a></li>
<li><a href="#org1d3fe76">27.2. 配置C++项目</a></li>
</ul>
</li>
<li><a href="#org6cd262a">28. cgroup v2</a>
<ul>
<li><a href="#org77d20c2">28.1. 组成</a></li>
<li><a href="#org469b329">28.2. 功能</a></li>
<li><a href="#org294aeac">28.3. 接口</a></li>
<li><a href="#org31eaef4">28.4. eg: pids控制器</a></li>
<li><a href="#orge5f34e4">28.5. 删除cgroup</a></li>
<li><a href="#orgf7f8d2b">28.6. 控制器概览</a>
<ul>
<li><a href="#org0fb2c19">28.6.1. cpu</a></li>
<li><a href="#orgfda2e86">28.6.2. cpuset: 控制cpu和内存亲和度</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>



<div id="outline-container-org3766660" class="outline-2">
<h2 id="org3766660"><span class="section-number-2">1.</span> fd (find)</h2>
<div class="outline-text-2" id="text-1">
<p>
在当前目录下的所有文件中寻找某字符串: 
</p>
<div class="org-src-container">
<pre class="src src-sh">fd . --type f <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#25991;&#20214;&#31867;&#22411; f, d ..</span>
     --exec grep --color=always -nH  -e rust  <span style="color: #98be65;">\{\}</span>  <span style="color: #5B6268;"># </span><span style="color: #5B6268;">-exec &#23545;&#27599;&#20010;&#26597;&#25214;&#20986;&#26469;&#30340;&#25991;&#20214;&#36335;&#24452;&#25191;&#34892;&#21629;&#20196;</span>
   <span style="color: #5B6268;">#  </span><span style="color: #5B6268;">&#20854;&#20013;{}&#20195;&#34920;&#36335;&#24452;, \{\} &#26159;&#20026;&#20102;&#38450;&#27490;&#27495;&#20041;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">find -type f -exec grep --color=always -nH -e hello <span style="color: #98be65;">\{\}</span> +  <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#23545;&#20110;find &#30340;-exec&#23376;&#21629;&#20196;, {}&#21518;&#38754;&#38656;&#35201;&#25509;&#19978;&#21152;&#21495;+ !!</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-sh">grep --color=always -nH -i -e hello &lt;FILE&gt;
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">-n &#34892;&#21495;</span>
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">-H &#25991;&#20214;&#21517;</span>
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">-e &#27491;&#21017;&#34920;&#36798;&#24335;</span>
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">-i &#24573;&#30053;&#22823;&#23567;&#20889;</span>
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">--color=always &#32473;&#26597;&#35810;&#32467;&#26524;&#19978;&#33394;</span>
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">--null &#22312;&#25991;&#20214;&#21517;&#21518;&#38754;&#21152;&#19978;&#23614;&#38646;.</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgb4bf943" class="outline-2">
<h2 id="orgb4bf943"><span class="section-number-2">2.</span> shell</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org9a43d6b" class="outline-3">
<h3 id="org9a43d6b"><span class="section-number-3">2.1.</span> 忽略错误继续执行</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #c678dd;">set</span> +e 
</pre>
</div>
<p>
恢复默认:
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">set</span> -e
</pre>
</div>
</div>
</div>


<div id="outline-container-org2a0730a" class="outline-3">
<h3 id="org2a0730a"><span class="section-number-3">2.2.</span> 退出 exit n</h3>
</div>

<div id="outline-container-org5ce42c2" class="outline-3">
<h3 id="org5ce42c2"><span class="section-number-3">2.3.</span> 判断文件是否存在</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #51afef;">if</span> [ -f $<span style="color: #dcaeea;">1</span> ]
<span style="color: #51afef;">then</span>

<span style="color: #51afef;">else</span>

<span style="color: #51afef;">fi</span>
</pre>
</div>


<p>
n* git
</p>
</div>
</div>
</div>


<div id="outline-container-org6e72e86" class="outline-2">
<h2 id="org6e72e86"><span class="section-number-2">3.</span> git</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org06b67fa" class="outline-3">
<h3 id="org06b67fa"><span class="section-number-3">3.1.</span> 设置/取消代理</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#35774;&#32622;ss</span>
git config --global http.proxy <span style="color: #98be65;">'socks5://127.0.0.1:1080'</span>

git config --global https.proxy <span style="color: #98be65;">'socks5://127.0.0.1:1080'</span>

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#35774;&#32622;&#20195;&#29702;</span>
git config --global https.proxy http://127.0.0.1:1080

git config --global https.proxy https://127.0.0.1:1080

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#21462;&#28040;&#20195;&#29702;</span>
git config --global --unset http.proxy

git config --global --unset https.proxy
</pre>
</div>
</div>
</div>

<div id="outline-container-org0882232" class="outline-3">
<h3 id="org0882232"><span class="section-number-3">3.2.</span> clone 子模块</h3>
<div class="outline-text-3" id="text-3-2">
<pre class="example">
git submodule update --init --recursive
</pre>
<p>
此命令经常无速度, 可能需要手动clone, 见 <code>.gitmodules</code>
</p>
</div>
</div>




<div id="outline-container-org71dae92" class="outline-3">
<h3 id="org71dae92"><span class="section-number-3">3.3.</span> 指定需要克隆的branch</h3>
<div class="outline-text-3" id="text-3-3">
<pre class="example">
git clone  -b fsf-gdb-10.1-with-sim&lt;分支&gt;   https://github.com/riscv-collab/riscv-binutils-gdb.git riscv-gdb&lt;别名&gt;
</pre>
</div>
</div>
</div>


<div id="outline-container-org0d47efc" class="outline-2">
<h2 id="org0d47efc"><span class="section-number-2">4.</span> grep -i 忽略大小写</h2>
</div>


<div id="outline-container-orgb6f1276" class="outline-2">
<h2 id="orgb6f1276"><span class="section-number-2">5.</span> fc-list 显示已安装字体</h2>
</div>

<div id="outline-container-org41720d1" class="outline-2">
<h2 id="org41720d1"><span class="section-number-2">6.</span> docker</h2>
<div class="outline-text-2" id="text-6">
<p>
恢复容器的运行 :  
</p>
<div class="org-src-container">
<pre class="src src-bash">sudo docker start <span style="color: #51afef; font-weight: bold;">`sudo docker ps -a -q`</span>
sudo docker attach <span style="color: #51afef; font-weight: bold;">`sudo docker ps -aq`</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga5047f5" class="outline-2">
<h2 id="orga5047f5"><span class="section-number-2">7.</span> tar fvx XXX</h2>
</div>

<div id="outline-container-orgfede6a4" class="outline-2">
<h2 id="orgfede6a4"><span class="section-number-2">8.</span> du -h 以可读形式显示文件大小</h2>
<div class="outline-text-2" id="text-8">
<div class="org-src-container">
<pre class="src src-sh">$ du -h linux-note.org 

12K     linux-note.org
</pre>
</div>
</div>

<div id="outline-container-orgd6203f7" class="outline-3">
<h3 id="orgd6203f7"><span class="section-number-3">8.1.</span> 查看目录下的大文件</h3>
<div class="outline-text-3" id="text-8-1">
<pre class="example">
du -sh .* * | grep G
</pre>
</div>
</div>
</div>



<div id="outline-container-org0cc1a86" class="outline-2">
<h2 id="org0cc1a86"><span class="section-number-2">9.</span> test命令</h2>
<div class="outline-text-2" id="text-9">
<div class="org-src-container">
<pre class="src src-sh">test <span style="color: #51afef; font-weight: bold;">`&#21629;&#20196;`</span> = <span style="color: #98be65;">'str'</span> 
test <span style="color: #51afef; font-weight: bold;">`&#21629;&#20196;`</span> = <span style="color: #98be65;">'string'</span> -a <span style="color: #51afef; font-weight: bold;">`&#21629;&#20196;`</span> = <span style="color: #98be65;">'string'</span>
test <span style="color: #51afef; font-weight: bold;">`&#21629;&#20196;`</span> = <span style="color: #98be65;">"string"</span> -o <span style="color: #51afef; font-weight: bold;">`&#21629;&#20196;`</span> = <span style="color: #98be65;">'string'</span>
</pre>
</div>

<p>
E.g
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#21028;&#26029;&#24403;&#21069;&#24179;&#21488;&#26159;&#21542;&#26159;linux</span>
test <span style="color: #51afef; font-weight: bold;">`uname -s`</span> = <span style="color: #98be65;">'Linux'</span>
<span style="color: #c678dd;">echo</span> $<span style="color: #dcaeea;">?</span> <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#36820;&#22238;&#38646;&#34920;&#31034;&#26080;&#38169;&#35823;&#21457;&#29983; </span>
</pre>
</div>
</div>
</div>



<div id="outline-container-org836492d" class="outline-2">
<h2 id="org836492d"><span class="section-number-2">10.</span> bash脚本的编写</h2>
<div class="outline-text-2" id="text-10">
</div>
<div id="outline-container-org976a87f" class="outline-3">
<h3 id="org976a87f"><span class="section-number-3">10.1.</span> <code>set -e</code> 遇到错误就停止</h3>
<div class="outline-text-3" id="text-10-1">
<p>
bash脚本默认行为是忽略错误,继续运行.
在脚本开头设置set -e就会使得: 只要有命令返回值!=0整个脚本的运行就会终止
</p>
</div>
</div>
</div>

<div id="outline-container-org774f89f" class="outline-2">
<h2 id="org774f89f"><span class="section-number-2">11.</span> pstree 查看进程树</h2>
<div class="outline-text-2" id="text-11">
<p>
<code>pstree -ap | grep mysql/redis ...</code>
</p>

<p>
在emacs中的shell运行pstree.
</p>
<pre class="example">
sun@Salted-PC:saltedf.github.io [main] $ pstree -ap | grep emacs

  |           `-emacs,65 -nw .
  |               |   |-grep,217 --color=auto emacs
  |               `-{emacs},66

</pre>
</div>
</div>


<div id="outline-container-org562155e" class="outline-2">
<h2 id="org562155e"><span class="section-number-2">12.</span> strace 追踪程序的系统调用</h2>
<div class="outline-text-2" id="text-12">
<p>
用于debug和理解程序的流程.
</p>

<div class="org-src-container">
<pre class="src src-bash">strace -f -s 65535 -i -t -T  -p &lt;pid&gt;    -o &#36755;&#20986;&#25991;&#20214; 
</pre>
</div>

<p>
有时候会输出大量信息, 根本无法分析, 若只是需要特定的系统调用,可以使用 <code>-e trace=</code> 进行过滤, 如:负责读取/接收这类的系统调用.
</p>

<p>
<code>-e trace=recvfrom,read,recv,recvmsg</code>
</p>

<pre class="example">
strace -f -s 65535 -i -t -T -e trace=write,sendto,send  -p &lt;PID&gt; 
</pre>


<p>
统计各个系统调用总耗时:
</p>

<div class="org-src-container">
<pre class="src src-bash">strace -c &lt;&#31243;&#24207;&gt;

strace -c -p &lt;PID&gt;
</pre>
</div>

<p>
结果显示了各个系统调用所花费总时间以及所占百分比, 调用次数, 以及出错次数. 出错越多一般代码质量越差.
</p>
<div class="org-src-container">
<pre class="src src-bash">
% time     seconds  usecs/call     calls    errors syscall
------ ----------- ----------- --------- --------- ----------------
 49.27    0.009506           7      1281           clock_gettime
 18.75    0.003617           9       390           rt_sigprocmask
  9.05    0.001747           9       175           ioctl
  8.12    0.001567          17        92           write
  5.40    0.001042          23        45           pselect6
  2.48    0.000478          28        17           fcntl
  2.38    0.000459          13        35           rt_sigreturn
  1.37    0.000265           6        38           read
  1.37    0.000264           7        35           timerfd_settime
  1.29    0.000249          27         9           poll
  0.37    0.000071          35         2           kill
  0.16    0.000030          15         2           getpid
  0.00    0.000000           0         2           close
  0.00    0.000000           0         2           openat
------ ----------- ----------- --------- --------- ----------------
100.00    0.019295                  2125           total

</pre>
</div>


<p>
代码分析组合拳: strace看关键调用. ==&gt; 用calltree找出关键系统调用的调用关系. ==&gt;用IDE细看这条调用链 
</p>
</div>
</div>


<div id="outline-container-orgcd31302" class="outline-2">
<h2 id="orgcd31302"><span class="section-number-2">13.</span> objdump -D 显示可执行文件/库文件的反汇编</h2>
<div class="outline-text-2" id="text-13">
<div class="org-src-container">
<pre class="src src-bash">objdump -D XXX | less 
</pre>
</div>
<p>
不加less会显示太多!
</p>
</div>
</div>


<div id="outline-container-orgab42851" class="outline-2">
<h2 id="orgab42851"><span class="section-number-2">14.</span> ldd 显示链接信息</h2>
<div class="outline-text-2" id="text-14">
<div class="org-src-container">
<pre class="src src-sh">$ ldd ./build/udpclient 

        linux-vdso.so.1 (0x00007ffcb2d85000)
        libstdc++.so.6 =&gt; /lib/x86_64-linux-gnu/libstdc++.so.6 (0x00007f4c64e2a000)
        libgcc_s.so.1 =&gt; /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007f4c64e0f000)
        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f4c64c1d000)
        libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007f4c64ace000)
        /lib64/ld-linux-x86-64.so.2 (0x00007f4c65024000)
</pre>
</div>
</div>
</div>


<div id="outline-container-org5dec9e4" class="outline-2">
<h2 id="org5dec9e4"><span class="section-number-2">15.</span> <a href="https://github.com/agentzh/code2ebook/">code2html</a> 的使用</h2>
<div class="outline-text-2" id="text-15">
<p>
先进入项目根目录: 
</p>

<ol class="org-ol">
<li>代码转html</li>
</ol>

<div class="org-src-container">
<pre class="src src-sh">src2html.pl --tab-width 4 --color --cross-reference <span style="color: #98be65;">\</span>
            --navigator --line-numbers . &lt;&#39033;&#30446;&#21517;&gt;
</pre>
</div>


<ol class="org-ol">
<li>html合成pdf</li>
</ol>
<div class="org-src-container">
<pre class="src src-sh">ebook-convert html_out/index.html llvm_release_1.pdf <span style="color: #98be65;">\</span>
        --use-profile-size <span style="color: #98be65;">\</span>
        --paper-size a3 <span style="color: #98be65;">\</span>
        --pdf-default-font-size 13 <span style="color: #98be65;">\</span>
        --pdf-mono-font-size 13 <span style="color: #98be65;">\</span>
        --margin-left 5 --margin-right 5 <span style="color: #98be65;">\</span>
        --margin-top 5 --margin-bottom 5 <span style="color: #98be65;">\</span>
        --page-breaks-before=<span style="color: #98be65;">'/'</span>  
</pre>
</div>
</div>
</div>


<div id="outline-container-org5feaf7b" class="outline-2">
<h2 id="org5feaf7b"><span class="section-number-2">16.</span> wget 保存整个网站</h2>
<div class="outline-text-2" id="text-16">
<p>
<a href="https://github.com/lujun9972/linux-document/blob/master/examples/10%20wget%20command%20examples.org">https://github.com/lujun9972/linux-document/blob/master/examples/10%20wget%20command%20examples.org</a>
</p>

<pre class="example">
wget --mirror --convert-links --page-requisites --no-parent -P /path/to/download https://example-domain.com
</pre>

<p>
但这样可能会下载不全，原因可能有很多。这里遇到的问题是默认是不跨域名下载的。
</p>


<p>
需要运行第二次，并附加上多个选项 
</p>

<pre class="example">
wget --mirror --convert-links -r -D "www.seas.upenn.edu,www.cis.upenn.edu"  -A.pdf -A.zip -A.shtml --tries=1 --timeout=8  --span-hosts  -l 5  --page-requisites --no-parent -P ./  https://www.seas.upenn.edu/\~cis341/17sp/  
</pre>


<ul class="org-ul">
<li>-A 指定那些没有被下载的文件类型 （需要观察网站特征获知）</li>

<li>&#x2013;span-hosts 跨主机名下载。</li>

<li>-D 指定域名/主机名 list，否则将遍历大量无用的域名（需要观察网站特征获知）</li>

<li>&#x2013;tries=1 重试一次，因为有些域名无法访问，也不含要下载的文件。</li>

<li>&#x2013;timeout=10 设定超时时间，防止等待太长时间。</li>
</ul>
</div>
</div>



<div id="outline-container-org1ed9d66" class="outline-2">
<h2 id="org1ed9d66"><span class="section-number-2">17.</span> 配置apt软件源</h2>
<div class="outline-text-2" id="text-17">
<div class="org-src-container">
<pre class="src src-bash">sudo vim /etc/apt/source.list

sudo apt-get update
</pre>
</div>
</div>
</div>





<div id="outline-container-org26c06e7" class="outline-2">
<h2 id="org26c06e7"><span class="section-number-2">18.</span> 在ArchLinux中安装deb</h2>
<div class="outline-text-2" id="text-18">
</div>
<div id="outline-container-org5f89a47" class="outline-3">
<h3 id="org5f89a47"><span class="section-number-3">18.1.</span> debtap</h3>
</div>

<div id="outline-container-org6d3030d" class="outline-3">
<h3 id="org6d3030d"><span class="section-number-3">18.2.</span> dpkg</h3>
<div class="outline-text-3" id="text-18-2">
<div class="org-src-container">
<pre class="src src-sh">yay -Sy dpkg

dpkg -i  xxx.deb
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgb00c1f6" class="outline-2">
<h2 id="orgb00c1f6"><span class="section-number-2">19.</span> <code>Xterm</code> 配置文件</h2>
<div class="outline-text-2" id="text-19">
<div class="org-src-container">
<pre class="src src-sh">cat ~/.Xresources
</pre>
</div>

<p>
修改后使配置生效: 
</p>
<div class="org-src-container">
<pre class="src src-sh">xrdb  ~/.Xresources
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">or: </span>
xrdb -merge ~/.Xresources 
</pre>
</div>
<p>
最后重启xterm.
</p>

<div class="org-src-container">
<pre class="src src-xml">
! font and locale
xterm.locale: true
xterm.utf8: true
xterm*utf8Title: true
xterm*fontMenu*fontdefault*Label: Default
! &#26012;&#20307;&#22312;&#26368;&#21518;&#28155;&#21152;`:italic`
xterm*faceName: Sarasa Mono SC:antialias=true:style=Book
xterm*faceSize: 15
xterm*faceNameDoublesize: Sarasa Mono SC  ! Noto Sans CJK SC
xterm*renderFont: true
xterm*xftAntialias: true
xterm*cjk_width: true

! &#31383;&#21475;&#35774;&#32622;
! &#31383;&#21475;&#22823;&#23567;&#21450;&#20301;&#32622;
xterm*geometry: 80x25
xterm*dynamicColors: true
xterm*saveLines: 2048
xterm*scrollKey: true
xterm*scrollTtyOutput: false
xterm*scrollBar: true
xterm*rightScrollBar: true
xterm*jumpScroll: true
xterm*multiScroll: true
xterm*toolBar: false
xterm*Scrollbar*thickness: 10
xterm*Scrollbar*background: black
xterm*Scrollbar*foreground: gray90
xterm*background: rgb:1a/1a/1a
xterm*foreground: rgb:d6/d6/d6
xterm*cursorColor: rgb:d6/d6/d6

! &#25552;&#20379;xterm-256color&#31867;&#22411;&#25903;&#25345;
! &#22914;&#26524;&#20462;&#25913;&#21518;&#65292;&#27809;&#26377;&#24471;&#21040;&#27491;&#30830;&#30340;&#32467;&#26524;&#65292;&#35828;&#26126;&#20320;&#21487;&#33021;&#38656;&#35201;&#23433;&#35013;ncurses-term&#21253;&#26469;&#25552;&#20379;xterm-256color&#31867;&#22411;&#25903;&#25345;
xterm*termName: xterm-256color

! &#21551;&#29992; Sixel &#22270;&#24418;&#25903;&#25345;
xterm*decTerminalID: vt340

! &#37197;&#32622;&#36873;&#25321;&#25991;&#26412;&#33258;&#21160;&#22797;&#21046;&#21040;&#21098;&#36148;&#26495;
! https://askubuntu.com/questions/237942/how-does-copy-paste-work-with-xterm
xterm*selectToClipboard: true

! &#21551;&#29992;&#8220;Ctrl+v&#8221;&#26469;&#22797;&#21046;
xterm*VT100.Translations: #override \
&lt;<span style="color: #c678dd;">Btn1Up</span>&gt;: select-end(CLIPBOARD,PRIMARY,CUT_BUFFER0) \n\
Ctrl &lt;<span style="color: #c678dd;">KeyPress</span>&gt; V: insert-selection(CLIPBOARD,PRIMARY,CUT_BUFFER0)

! &#35299;&#20915;Alt&#38190;&#19981;&#22909;&#20351;
xterm*eightBitInput: false
xterm*altSendsEscape: true

! &#37197;&#32622;&#20027;&#39064;
! -- Tango color scheme
xterm*color0: #2e3436
xterm*color1: #cc0000
xterm*color2: #4e9a06
xterm*color3: #c4a000
xterm*color4: #3465a4
xterm*color5: #75507b
xterm*color6: #0b939b
xterm*color7: #d3d7cf
xterm*color8: #555753
xterm*color9: #ef2929
xterm*color10: #8ae234
xterm*color11: #fce94f
xterm*color12: #729fcf
xterm*color13: #ad7fa8
xterm*color14: #00f5e9
xterm*color15: #eeeeec

</pre>
</div>
</div>
</div>




<div id="outline-container-org10cf1d4" class="outline-2">
<h2 id="org10cf1d4"><span class="section-number-2">20.</span> ssh</h2>
<div class="outline-text-2" id="text-20">
</div>
<div id="outline-container-org250ee66" class="outline-3">
<h3 id="org250ee66"><span class="section-number-3">20.1.</span> 重启ssh服务</h3>
<div class="outline-text-3" id="text-20-1">
<div class="org-src-container">
<pre class="src src-bash">sudo service ssh restart
</pre>
</div>
</div>
</div>






<div id="outline-container-org448d5de" class="outline-3">
<h3 id="org448d5de"><span class="section-number-3">20.2.</span> 查看ssh服务是否启动</h3>
<div class="outline-text-3" id="text-20-2">
<div class="org-src-container">
<pre class="src src-bash">sudo lsof -i :22 
</pre>
</div>
</div>
</div>
</div>





<div id="outline-container-orgde6aa5a" class="outline-2">
<h2 id="orgde6aa5a"><span class="section-number-2">21.</span> 递归改变文件owner</h2>
<div class="outline-text-2" id="text-21">
<div class="org-src-container">
<pre class="src src-bash">chown -R sun:sun ./dir
</pre>
</div>
</div>
</div>




<div id="outline-container-org6874d1e" class="outline-2">
<h2 id="org6874d1e"><span class="section-number-2">22.</span> 汇编文件(.s)的结构</h2>
<div class="outline-text-2" id="text-22">
<pre class="example">
.text: 代码段
.data: 常量 字符串 初始化的全局变量
.bss: 不占用实际空间, 仅仅标记那些局部变量和未初始化的全局变量.
</pre>


<p>
因为已知初值的且生命周期长的变量才有提前为它们分配空间的必要,因此data段才占用空间. bss段中记录的是局部变量/未初始化的全局变量, 没必要一开始就为这些量准备好空间, 只要在程序实际运行时为其准备空间即可. 
</p>
</div>
</div>







<div id="outline-container-orgbac7cc4" class="outline-2">
<h2 id="orgbac7cc4"><span class="section-number-2">23.</span> makefile</h2>
<div class="outline-text-2" id="text-23">
</div>
<div id="outline-container-org135ccae" class="outline-3">
<h3 id="org135ccae"><span class="section-number-3">23.1.</span> 定义变量</h3>
<div class="outline-text-3" id="text-23-1">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #dcaeea;">CC</span> := gcc <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#23450;&#20041;&#24120;&#37327;, &#21518;&#32493;&#19981;&#33021;&#29992;+=</span>
<span style="color: #dcaeea;">OBJS</span> = hello.o world.o <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#23450;&#20041;&#21464;&#37327;, &#21518;&#32493;&#21487;&#20197;&#29992;+=&#22686;&#21152;</span>
<span style="color: #dcaeea;">ObJS</span> += fuck.o  
</pre>
</div>
</div>
</div>





<div id="outline-container-orga60ea87" class="outline-3">
<h3 id="orga60ea87"><span class="section-number-3">23.2.</span> 伪目标 .PHONY</h3>
<div class="outline-text-3" id="text-23-2">
<p>
通常是指那些不生成文件的. 只负责执行某些命令的.
</p>


<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #51afef;">.PHONY</span>: clean  <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#36825;&#20010;&#20043;&#21518;&#30340;target&#37117;&#26159;&#20266;&#30446;&#26631;</span>

<span style="color: #51afef;">clean</span>: 
        <span style="color: #ECBE7B;">-</span>${<span style="color: #dcaeea;">RM</span>} *.o ${<span style="color: #dcaeea;">target</span>}
        echo <span style="color: #98be65;">"finish"</span>

</pre>
</div>
</div>
</div>






<div id="outline-container-org92d112d" class="outline-3">
<h3 id="org92d112d"><span class="section-number-3">23.3.</span> 为整个项目添加宏定义</h3>
<div class="outline-text-3" id="text-23-3">
<div class="org-src-container">
<pre class="src src-makefile">
<span style="color: #dcaeea;">DEFS</span> = -D_DEBUG -D_POSIX_SOURCE

<span style="color: #dcaeea;">FLAGS</span> = -g ${<span style="color: #dcaeea;">DEFS</span>}

</pre>
</div>
</div>
</div>






<div id="outline-container-orgabd670f" class="outline-3">
<h3 id="orgabd670f"><span class="section-number-3">23.4.</span> 为目标链接上库</h3>
<div class="outline-text-3" id="text-23-4">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #dcaeea;">LIBS</span> = -lpthread -lqt

</pre>
</div>
</div>
</div>






<div id="outline-container-org641d9ca" class="outline-3">
<h3 id="org641d9ca"><span class="section-number-3">23.5.</span> 通配符</h3>
<div class="outline-text-3" id="text-23-5">
<div class="org-src-container">
<pre class="src src-bash">* &#25152;&#26377;
% :&#20219;&#24847;&#19968;&#20010;&#25991;&#20214;
? :
</pre>
</div>




<div class="org-src-container">
<pre class="src src-bash">$<span style="color: #dcaeea;">@</span> &#30446;&#26631;
$^ &#20840;&#37096;&#30340;&#20381;&#36182;&#25991;&#20214;
$&lt; &#39318;&#20010;&#20381;&#36182;&#39033; 
</pre>
</div>





<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #51afef;">${</span><span style="color: #51afef;">target</span><span style="color: #51afef;">}</span> : ${<span style="color: #dcaeea;">OBJS</span>}
        ${<span style="color: #dcaeea;">CC</span>} ${<span style="color: #dcaeea;">FLAGS</span>} -o <span style="color: #51afef;">$</span><span style="color: #a9a1e1;">@</span> $<span style="color: #a9a1e1;">^</span> ${<span style="color: #dcaeea;">LIBS</span>}


<span style="color: #51afef;">%.o</span> : %.c
        ${<span style="color: #dcaeea;">CC</span>} -o <span style="color: #51afef;">$</span><span style="color: #a9a1e1;">@</span>  $<span style="color: #a9a1e1;">^</span> 
</pre>
</div>
</div>
</div>







<div id="outline-container-org564dca4" class="outline-3">
<h3 id="org564dca4"><span class="section-number-3">23.6.</span> 函数调用</h3>
<div class="outline-text-3" id="text-23-6">
<div class="org-src-container">
<pre class="src src-makefile">$(<span style="color: #dcaeea;">my_func</span> arg1,arg2,arg3)
</pre>
</div>
</div>



<div id="outline-container-orgd48dc2c" class="outline-4">
<h4 id="orgd48dc2c"><span class="section-number-4">23.6.1.</span> 当前目录下某一类型的所有文件形成的列表</h4>
<div class="outline-text-4" id="text-23-6-1">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #dcaeea;">SRC</span> = $(<span style="color: #dcaeea;">wildcard</span> *.c)  ==&gt; hello.c world.c fuck.c  
</pre>
</div>
</div>
</div>





<div id="outline-container-orgd539509" class="outline-4">
<h4 id="orgd539509"><span class="section-number-4">23.6.2.</span> 将列表中的所有匹配项替换为指定形式</h4>
<div class="outline-text-4" id="text-23-6-2">
<div class="org-src-container">
<pre class="src src-makefile"><span style="color: #dcaeea;">OBJS</span> = $(<span style="color: #dcaeea;">patsubset</span> %.c,%.o,${<span style="color: #dcaeea;">SRC</span>} ) 

<span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#23558; SRC = hello.c fuck.c &#26367;&#25442;&#25104; hello.o fuck.o </span>
</pre>
</div>
</div>
</div>
</div>
</div>








<div id="outline-container-org73834d2" class="outline-2">
<h2 id="org73834d2"><span class="section-number-2">24.</span> GDB</h2>
<div class="outline-text-2" id="text-24">
<p>
gef/cgdb/emacs gdb-many-windows
</p>
</div>

<div id="outline-container-org75a7a21" class="outline-3">
<h3 id="org75a7a21"><span class="section-number-3">24.1.</span> 为可执行文件设置环境变量</h3>
<div class="outline-text-3" id="text-24-1">
<p>
set environment FOO = XX 
unset environment FOO
</p>
</div>
</div>

<div id="outline-container-org3ca96c9" class="outline-3">
<h3 id="org3ca96c9"><span class="section-number-3">24.2.</span> 为可执行程序传参</h3>
<div class="outline-text-3" id="text-24-2">
<ul class="org-ul">
<li>进入gdb shell后:</li>
</ul>

<p>
<code>run arg1 arg2 ...</code>
</p>

<p>
<code>set args arg1 arg2 arg3</code>
</p>

<ul class="org-ul">
<li>启动gdb时通过命令行传参:</li>
</ul>

<p>
<code>gdb ./main --args ./main a1 a2 a3 ...</code>
</p>

<p>
这种方式需要额外再写一次可执行文件的路径.
</p>
</div>
</div>




<div id="outline-container-orgab5d8cb" class="outline-3">
<h3 id="orgab5d8cb"><span class="section-number-3">24.3.</span> 显示某文件源代码</h3>
<div class="outline-text-3" id="text-24-3">
<div class="org-src-container">
<pre class="src src-bash">l / list &lt;&#20989;&#25968;&gt; 
</pre>
</div>

<p>
默认显示10行
</p>


<p>
当有多个文件时, 为了显示其中一个文件要在文件名后加 <code>:N</code> , 否则会被视作函数名. 
</p>
<pre class="example">
list myfile.cc:1
</pre>
</div>
</div>



<div id="outline-container-org01cc234" class="outline-3">
<h3 id="org01cc234"><span class="section-number-3">24.4.</span> 添加断点</h3>
<div class="outline-text-3" id="text-24-4">
<p>
用break可以添加断点, 既能在指定行上添加, 也能为指定函数添加断点.(经常用在一行中有多个函数时)
</p>

<div class="org-src-container">
<pre class="src src-gdb">break myfile.cc:100
=====================
break myfunc
</pre>
</div>
</div>
</div>

<div id="outline-container-org1f5b8a2" class="outline-3">
<h3 id="org1f5b8a2"><span class="section-number-3">24.5.</span> 查看断点</h3>
<div class="outline-text-3" id="text-24-5">
<p>
显示了断点是否被禁用, 以及断点打在何处. 每个断点都有一个ID, 对断点的操作都基于此ID
</p>
<pre class="example">

(gdb) info breakpoints
Num     Type           Disp Enb Address            What
1       breakpoint     keep y   0x0000000000408d60 in test_scanner_hello_Test::TestBody() at /home/sun/src/my_compiler/mytest/test_scanner.cc:10
</pre>
</div>
</div>

<div id="outline-container-org43a5966" class="outline-3">
<h3 id="org43a5966"><span class="section-number-3">24.6.</span> 禁用断点</h3>
<div class="outline-text-3" id="text-24-6">
<div class="org-src-container">
<pre class="src src-gdb">(gdb) disable breakpoints 4 
(gdb) i b
Num     Type           Disp Enb Address            What
4       breakpoint     keep n   0x0000000000408d60 in test_scanner_hello_Test::TestBody() at /home/sun/src/my_compiler/mytest/test_scanner.cc:10

</pre>
</div>
</div>
</div>

<div id="outline-container-orgda59d2e" class="outline-3">
<h3 id="orgda59d2e"><span class="section-number-3">24.7.</span> 重新启用断点</h3>
<div class="outline-text-3" id="text-24-7">
<pre class="example">
(gdb) enable 4
(gdb) i b 
Num     Type           Disp Enb Address            What
4       breakpoint     keep y   0x0000000000408d60 in test_scanner_hello_Test::TestBody() at /home/sun/src/my_compiler/mytest/test_scanner.cc:10
</pre>
</div>
</div>

<div id="outline-container-orga2c7a8d" class="outline-3">
<h3 id="orga2c7a8d"><span class="section-number-3">24.8.</span> 删除断点</h3>
<div class="outline-text-3" id="text-24-8">
<p>
用断点序号指定要删除的断点
</p>
<div class="org-src-container">
<pre class="src src-gdb">(gdb) delete breakpoints 1
</pre>
</div>
</div>
</div>


<div id="outline-container-org3c7a344" class="outline-3">
<h3 id="org3c7a344"><span class="section-number-3">24.9.</span> 保存断点到文件</h3>
<div class="outline-text-3" id="text-24-9">
<p>
这个功能本身很简陋, 使用前提是源代码不能修改过.
save breakpoints myfile
</p>

<p>
恢复断点:
source &lt;myfile&gt;
</p>
</div>
</div>




<div id="outline-container-org6a09d2a" class="outline-3">
<h3 id="org6a09d2a"><span class="section-number-3">24.10.</span> 单步跳过 next</h3>
<div class="outline-text-3" id="text-24-10">
<p>
不会进入函数内部.
</p>
</div>
</div>

<div id="outline-container-orgebfa63a" class="outline-3">
<h3 id="orgebfa63a"><span class="section-number-3">24.11.</span> 继续执行, 直至遇到断点</h3>
<div class="outline-text-3" id="text-24-11">
<p>
continue
</p>
</div>
</div>

<div id="outline-container-orgfa7780c" class="outline-3">
<h3 id="orgfa7780c"><span class="section-number-3">24.12.</span> 运行到某处,忽略期间的断点</h3>
<div class="outline-text-3" id="text-24-12">
<p>
until &lt;N行&gt; 运行下面N行, 忽略之间的断点.
</p>
</div>
</div>

<div id="outline-container-orgab7ec9c" class="outline-3">
<h3 id="orgab7ec9c"><span class="section-number-3">24.13.</span> 进入到函数内部</h3>
<div class="outline-text-3" id="text-24-13">
<p>
step
</p>
</div>
</div>

<div id="outline-container-org386d8b5" class="outline-3">
<h3 id="org386d8b5"><span class="section-number-3">24.14.</span> 从函数中跳出并暂停</h3>
<div class="outline-text-3" id="text-24-14">
<p>
finish
</p>
</div>
</div>



<div id="outline-container-orgde7f3c0" class="outline-3">
<h3 id="orgde7f3c0"><span class="section-number-3">24.15.</span> 强制从函数中返回特定值</h3>
<div class="outline-text-3" id="text-24-15">
<p>
return 
相当于一种特殊的jump, 并不会将函数体执行完.并指定一个返回值
</p>
</div>
</div>
<div id="outline-container-org992d939" class="outline-3">
<h3 id="org992d939"><span class="section-number-3">24.16.</span> 跳转到指定位置继续执行</h3>
<div class="outline-text-3" id="text-24-16">
<p>
jump linenum 
</p>

<p>
跳转后不会自动暂停, 需要断点.
</p>
</div>
</div>

<div id="outline-container-orgdc966cc" class="outline-3">
<h3 id="orgdc966cc"><span class="section-number-3">24.17.</span> 显示当前所有的局部变量</h3>
<div class="outline-text-3" id="text-24-17">
<p>
info loacls
</p>
</div>
</div>
<div id="outline-container-org2bf9a09" class="outline-3">
<h3 id="org2bf9a09"><span class="section-number-3">24.18.</span> 变量/表达式相关</h3>
<div class="outline-text-3" id="text-24-18">
</div>
<div id="outline-container-orgaac24c6" class="outline-4">
<h4 id="orgaac24c6"><span class="section-number-4">24.18.1.</span> 打印变量/表达式</h4>
<div class="outline-text-4" id="text-24-18-1">
<div class="org-src-container">
<pre class="src src-gdb">(gdb)  print tk.kind_
$2 = mycompiler::Token::INT
</pre>
</div>
</div>
</div>

<div id="outline-container-orgca13cf7" class="outline-4">
<h4 id="orgca13cf7"><span class="section-number-4">24.18.2.</span> 自动显示变量值</h4>
<div class="outline-text-4" id="text-24-18-2">
<p>
display
每次都将这些变量的值打印处理.
</p>

<pre class="example">
(gdb) info display
Auto-display expressions now in effect:
Num Enb Expression
1:   y  tk.kind_
</pre>
</div>
</div>

<div id="outline-container-org9206474" class="outline-4">
<h4 id="org9206474"><span class="section-number-4">24.18.3.</span> 取消对变量的自动显示</h4>
<div class="outline-text-4" id="text-24-18-3">
<p>
undisplay + N
</p>
</div>
</div>





<div id="outline-container-org5fd3c66" class="outline-4">
<h4 id="org5fd3c66"><span class="section-number-4">24.18.4.</span> 显示变量/表达式类型</h4>
<div class="outline-text-4" id="text-24-18-4">
<p>
用what/whatis
</p>
<div class="org-src-container">
<pre class="src src-gdb">(gdb) what tk.kind_
type = mycompiler::Token::Kind
(gdb) what 1+3
type = int
(gdb) whatis tk.kind_
type = mycompiler::Token::Kind
</pre>
</div>
</div>
</div>

<div id="outline-container-org124b2c1" class="outline-4">
<h4 id="org124b2c1"><span class="section-number-4">24.18.5.</span> 修改变量的值</h4>
<div class="outline-text-4" id="text-24-18-5">
<p>
可以在不修改源码的情况下对一些值进行设置.
</p>

<pre class="example">
(gdb) set var tk.kind_ = mycompiler::Token::END
</pre>
</div>
</div>



<div id="outline-container-orgdbe4131" class="outline-4">
<h4 id="orgdbe4131"><span class="section-number-4">24.18.6.</span> 监视某变量的值</h4>
<div class="outline-text-4" id="text-24-18-6">
<p>
只要这个值发生改变就会自动暂停,并显示新值和旧值.
</p>

<p>
watch tk.kind_
</p>


<p>
显示所有watchpoints
info watchpoints
</p>
</div>
</div>
</div>




<div id="outline-container-org2a4793c" class="outline-3">
<h3 id="org2a4793c"><span class="section-number-3">24.19.</span> 栈相关</h3>
<div class="outline-text-3" id="text-24-19">
</div>
<div id="outline-container-org9668619" class="outline-4">
<h4 id="org9668619"><span class="section-number-4">24.19.1.</span> 显示堆栈信息: bt</h4>
</div>



<div id="outline-container-org28f9c96" class="outline-4">
<h4 id="org28f9c96"><span class="section-number-4">24.19.2.</span> 切换栈帧</h4>
<div class="outline-text-4" id="text-24-19-2">
<p>
up/down: 上一层栈帧/下一层栈帧
</p>

<p>
<code>frame N</code> / <code>f N</code> 切换到指定栈帧中
</p>
</div>
</div>
</div>


<div id="outline-container-org1692ab0" class="outline-3">
<h3 id="org1692ab0"><span class="section-number-3">24.20.</span> 调试已经运行的程序</h3>
<div class="outline-text-3" id="text-24-20">
<p>
首先需要获得其进程pid
</p>

<p>
attach PID
</p>

<p>
detach
</p>
</div>
</div>


<div id="outline-container-org412df64" class="outline-3">
<h3 id="org412df64"><span class="section-number-3">24.21.</span> 检查点</h3>
<div class="outline-text-3" id="text-24-21">
<p>
通过fork出新的进程来保存当前运行位置和状态.
</p>
</div>

<div id="outline-container-orge503029" class="outline-4">
<h4 id="orge503029"><span class="section-number-4">24.21.1.</span> 在当前位置添加checkpoint</h4>
<div class="outline-text-4" id="text-24-21-1">
<p>
checkpoint 
</p>
</div>
</div>


<div id="outline-container-org34e985e" class="outline-4">
<h4 id="org34e985e"><span class="section-number-4">24.21.2.</span> 查看所有checkpoints</h4>
<div class="outline-text-4" id="text-24-21-2">
<p>
info checkpoints
</p>
</div>
</div>


<div id="outline-container-orge0c02b0" class="outline-4">
<h4 id="orge0c02b0"><span class="section-number-4">24.21.3.</span> 删除指定checkpoint</h4>
<div class="outline-text-4" id="text-24-21-3">
<p>
delete checkpoint N
</p>
</div>
</div>
</div>






<div id="outline-container-org1565b8c" class="outline-3">
<h3 id="org1565b8c"><span class="section-number-3">24.22.</span> 线程</h3>
<div class="outline-text-3" id="text-24-22">
</div>
<div id="outline-container-orgc2bbfbb" class="outline-4">
<h4 id="orgc2bbfbb"><span class="section-number-4">24.22.1.</span> 显示所有线程</h4>
<div class="outline-text-4" id="text-24-22-1">
<p>
info threads
</p>
</div>
</div>

<div id="outline-container-org63623b1" class="outline-4">
<h4 id="org63623b1"><span class="section-number-4">24.22.2.</span> 切换到指定线程</h4>
<div class="outline-text-4" id="text-24-22-2">
<p>
thread N
</p>
</div>
</div>
</div>






<div id="outline-container-orgd887d01" class="outline-3">
<h3 id="orgd887d01"><span class="section-number-3">24.23.</span> 以指定格式显示某地址处的内容</h3>
<div class="outline-text-3" id="text-24-23">
<p>
x/格式+长度 &lt;地址&gt;
</p>
</div>
</div>



<div id="outline-container-org40faf3e" class="outline-3">
<h3 id="org40faf3e"><span class="section-number-3">24.24.</span> 反向运行</h3>
<div class="outline-text-3" id="text-24-24">
<p>
记录反向运行所需信息
</p>

<p>
target record-full 
</p>


<p>
reverse-next
reverse-XXX
</p>
</div>
</div>
</div>



<div id="outline-container-org0e48f95" class="outline-2">
<h2 id="org0e48f95"><span class="section-number-2">25.</span> valgrind</h2>
<div class="outline-text-2" id="text-25">
</div>
<div id="outline-container-org0f47e0e" class="outline-3">
<h3 id="org0f47e0e"><span class="section-number-3">25.1.</span> 无法使用, 报错</h3>
<div class="outline-text-3" id="text-25-1">
<ol class="org-ol">
<li>首先尝试更新系统到最新, 然后重启</li>
</ol>
<pre class="example">
sudo pacman -Syu
</pre>

<pre class="example">
sudo reboot
</pre>

<ol class="org-ol">
<li>否则可以试下安装 <code>glibc-debug</code></li>
</ol>
<p>
在 <code>/etc/pacman.conf</code> 中临时启用:
</p>
<pre class="example">
[system-debug]
Server = https://debuginfod.artixlinux.org/$repo/os/$arch
[world-debug]
Server = https://debuginfod.artixlinux.org/$repo/os/$arch
[galaxy-debug]
Server = https://debuginfod.artixlinux.org/$repo/os/$arch
[lib32-debug]
Server = https://debuginfod.artixlinux.org/$repo/os/$arch
</pre>
<p>
<a href="https://www.reddit.com/r/artixlinux/comments/wpji7m/valgrind_cant_load_debug_info/">https://www.reddit.com/r/artixlinux/comments/wpji7m/valgrind_cant_load_debug_info/</a>
</p>

<pre class="example">
sudo pacman -Sy glibc-debug
</pre>
</div>
</div>
</div>



<div id="outline-container-org441336a" class="outline-2">
<h2 id="org441336a"><span class="section-number-2">26.</span> <a href="./cmake-learning.html">CMake</a></h2>
<div class="outline-text-2" id="text-26">
<div class="org-src-container">
<pre class="src src-cmake">cmake_minimum_required(VERSION 3.21)
project(word-count C)

# 设置编译器
set(CMAKE_C_STANDARD 99)
set(CMAKE_C_STANDARD_REQUIRED ON)
set(CMAKE_C_COMPILER clang)

add_compile_options(
"-ggdb" # gdb调试支持
"-m64"  
) 
# add_compile_definitions(LINE_COUNT) # 宏定义
## add_compile_definitions(MACRO_CONSTANT_NAME=macro_value)

# 生成 compile_commands.json 文件  for clangd
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

include_directories(./include) # 头文件目录

add_executable(test_strcmp.bin)
target_sources(test_strcmp.bin PRIVATE
  ./test_strcmp.c
  ./str_cmp.c
)

# target_compile_options(test_strcmp.bin PRIVATE -ggdb)
# target_include_directories(YourExecutableName PRIVATE include)


add_executable(tokenize.bin)
target_sources(tokenize.bin PRIVATE
  ./tokenize.c
  ./vector_char.c
)


add_executable(dictionary.bin)
target_sources(dictionary.bin PRIVATE
  ./dictionary.c
  ./vector_char.c
  ./vector_string.c
  ./str_cmp.c
)

# add_executable(wordcount.bin)
# target_sources(wordcount.bin PRIVATE
#   ./wordcount.c
#   ./vector_char.c
#   ./table_string.c
#   ./str_cmp.c
# )


add_executable(linecount.bin)
target_sources(linecount.bin PRIVATE
  ./linecount.c
  ./vector_char.c
  ./table_string.c
  ./str_cmp.c
)


add_executable(duplicate.bin)
target_sources(duplicate.bin PRIVATE
  ./dedup.c
  ./vector_char.c
  ./table_string.c
  ./duplicate.c
  ./str_cmp.c
)


add_executable(unit_test_vector_char.bin)
target_sources(unit_test_vector_char.bin PRIVATE
  ./unit_test_vector_char.c
  ./vector_char.c
)


# add_executable(unit_test_vector_string.bin)
# target_sources(unit_test_vector_string.bin PRIVATE
#   ./unit_test_vector_string.c
#   ./vector_string.c
#   ./str_cmp.c
# )

add_executable(unit_test_table_string.bin)
target_sources(unit_test_table_string.bin PRIVATE
  ./unit_test_table_string.c
  ./table_string.c
  ./vector_char.c
  ./str_cmp.c
)

</pre>
</div>
</div>
</div>


<div id="outline-container-orgef9a14f" class="outline-2">
<h2 id="orgef9a14f"><span class="section-number-2">27.</span> clangd 配置</h2>
<div class="outline-text-2" id="text-27">
<p>
在项目根目录下添加文件: <code>.clangd</code>
参考: <a href="https://clangd.llvm.org/config#compileflags">https://clangd.llvm.org/config#compileflags</a>
</p>
</div>

<div id="outline-container-orgc9e1410" class="outline-3">
<h3 id="orgc9e1410"><span class="section-number-3">27.1.</span> 配置纯C项目</h3>
<div class="outline-text-3" id="text-27-1">
<pre class="example">
CompileFlags:
  Add: [-xc,-std=c99]
  Compiler: clang
</pre>
</div>
</div>

<div id="outline-container-org1d3fe76" class="outline-3">
<h3 id="org1d3fe76"><span class="section-number-3">27.2.</span> 配置C++项目</h3>
<div class="outline-text-3" id="text-27-2">
<pre class="example">
CompileFlags:                        # Tweak the parse settings
  Add: [-xc++, -std=c++20]           # treat all files as C++
  Compiler: clang++                  # Change argv[0] of compile flags to `clang++`
</pre>
</div>
</div>
</div>



<div id="outline-container-org6cd262a" class="outline-2">
<h2 id="org6cd262a"><span class="section-number-2">28.</span> cgroup v2</h2>
<div class="outline-text-2" id="text-28">
<p>
查看cgroup 版本:
</p>
<div class="org-src-container">
<pre class="src src-sh">cat /proc/mounts | grep cgroup
</pre>
</div>



<p>
cgroup2(伪)文件系统位于:
</p>
<div class="org-src-container">
<pre class="src src-sh">/sys/fs/cgroup
</pre>
</div>

<p>
其文件系统类型是 <code>cgroup2</code>
其接口是通过文件系统来提供的.
</p>
</div>







<div id="outline-container-org77d20c2" class="outline-3">
<h3 id="org77d20c2"><span class="section-number-3">28.1.</span> 组成</h3>
<div class="outline-text-3" id="text-28-1">
<p>
control groups 由两个部分组成:
</p>

<ol class="org-ol">
<li>一组进程</li>
<li>控制器(subsystem), 对进程组进行控制.</li>
</ol>

<p>
control group: 一组进程出于资源管理的目的被绑在一起.这组进程共享同一个内存分配或者cpu
</p>
</div>
</div>


<div id="outline-container-org469b329" class="outline-3">
<h3 id="org469b329"><span class="section-number-3">28.2.</span> 功能</h3>
<div class="outline-text-3" id="text-28-2">
<ul class="org-ul">
<li>限制组的资源使用
限制某个组的cpu可用百分比/ 可用内存的百分比</li>

<li>调整组的资源分配优先级
例如网络带宽</li>

<li>测量资源使用情况</li>

<li>冻结一个组
通过不给这个组CPU时间, 并且在之后可以恢复他们.</li>
</ul>
</div>
</div>




<div id="outline-container-org294aeac" class="outline-3">
<h3 id="org294aeac"><span class="section-number-3">28.3.</span> 接口</h3>
<div class="outline-text-3" id="text-28-3">
<p>
mkdir/rmdir 创建cgroups
</p>

<p>
每个子目录包含了被自动创建出的文件.一些文件是用来管理cgroup自身的.(eg哪些进程属于这个cgroup)
另一些是和特定的控制器相关的.
</p>
</div>
</div>




<div id="outline-container-org31eaef4" class="outline-3">
<h3 id="org31eaef4"><span class="section-number-3">28.4.</span> eg: pids控制器</h3>
<div class="outline-text-3" id="text-28-4">
<div class="org-src-container">
<pre class="src src-bash">sudo bash
<span style="color: #c678dd;">cd</span> /sys/fs/cgroup
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">cat cgroup.controllers

cpuset cpu io memory hugetlb pids rdma misc
</pre>
</div>


<div class="org-src-container">
<pre class="src src-zsh">cat cgroup.subtree_control

cpuset cpu io memory pids
</pre>
</div>

<p>
创建一个cgroup
</p>
<div class="org-src-container">
<pre class="src src-zsh">mkdir mygrp
</pre>
</div>


<p>
将当前shell进程移入这个组:
</p>
<div class="org-src-container">
<pre class="src src-zsh">echo $$ &gt; mygrp/cgroup.procs
</pre>
</div>

<div class="org-src-container">
<pre class="src src-zsh">cat cgroup.procs

106480
106851
</pre>
</div>
<p>
一个pid是bash, 另一个是bash的子进程 cat.
fork创建出的子进程自动和父进程同属一个cgroup.
</p>




<p>
查看当前进程所在的cgroup信息:
</p>

<div class="org-src-container">
<pre class="src src-zsh">cat /proc/$$/cgroup

0::/mygrp
</pre>
</div>


<p>
查看当前cgroup中有几个进程:
</p>
<div class="org-src-container">
<pre class="src src-sh">cat mygrp/pids.current

2
</pre>
</div>

<p>
查看最大容许的进程数量
</p>
<div class="org-src-container">
<pre class="src src-sh">cat mygrp/pids.max

max <span style="color: #5B6268;"># </span><span style="color: #5B6268;">&#20195;&#34920;&#27809;&#26377;&#38480;&#21046;</span>
</pre>
</div>

<p>
echo 5 &gt; mygrp/pids.max
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">echo</span> 4 &gt;  mygrp/pids.max 
cat mygrp/pids.max

4
</pre>
</div>


<p>
然后通过这个shell创建多个sleep进程, 可以观察到无法创建出更多进程了.
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #51afef;">for</span> j<span style="color: #51afef;"> in</span> $(seq 1 5); <span style="color: #51afef;">do</span> sleep 60 &amp; <span style="color: #51afef;">done</span>

[1] 109424
[2] 109425
[3] 109426
bash: fork: retry: Resource temporarily unavailable
bash: fork: retry: Resource temporarily unavailable
bash: fork: retry: Resource temporarily unavailable
bash: fork: retry: Resource temporarily unavailable
bash: fork: Resource temporarily unavailable
</pre>
</div>
</div>
</div>

<div id="outline-container-orge5f34e4" class="outline-3">
<h3 id="orge5f34e4"><span class="section-number-3">28.5.</span> 删除cgroup</h3>
<div class="outline-text-3" id="text-28-5">
<p>
无法直接rmdir非空的(有进程)cgroup.
</p>

<p>
先将shell进程移动到父cgroup中
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">echo</span> $<span style="color: #dcaeea;">$</span> &gt; /sys/fs/cgroup/cgroup.procs 
</pre>
</div>
<p>
然后查看mygrp中的进程个数:
</p>
<div class="org-src-container">
<pre class="src src-sh">cat /sys/fs/cgroup/mygrp/pids.current

0
</pre>
</div>
<p>
为零, 可见顺利将shell移出了mygrp. 
</p>


<p>
此时可以用rmdir成功删除之前创建的cgroup.
(那些被内核自动创建出来的文件无需删除,也无法被删除)
</p>
</div>
</div>


<div id="outline-container-orgf7f8d2b" class="outline-3">
<h3 id="orgf7f8d2b"><span class="section-number-3">28.6.</span> 控制器概览</h3>
<div class="outline-text-3" id="text-28-6">
</div>
<div id="outline-container-org0fb2c19" class="outline-4">
<h4 id="org0fb2c19"><span class="section-number-4">28.6.1.</span> cpu</h4>
<div class="outline-text-4" id="text-28-6-1">
<p>
限制并测量cpu的使用. 有两种模式, 可以混合使用:
</p>
<ul class="org-ul">
<li>比例权重(默认)</li>
<li>带宽控制模式</li>
</ul>


<p>
权重模式只在发生cpu争用时才会施加限制:
</p>


<div id="orgd312b87" class="figure">
<p><img src="org-images/2023-03-21_16-03-41_screenshot.png" alt="2023-03-21_16-03-41_screenshot.png" width="500px" />
</p>
</div>


<p>
带宽模式即使在没有其它组的进程时也会严格施加限制:
</p>


<div id="org4db9d50" class="figure">
<p><img src="org-images/2023-03-21_16-06-41_screenshot.png" alt="2023-03-21_16-06-41_screenshot.png" width="500px" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgfda2e86" class="outline-4">
<h4 id="orgfda2e86"><span class="section-number-4">28.6.2.</span> cpuset: 控制cpu和内存亲和度</h4>
</div>
</div>
</div>
</div>
</body>
</html>
